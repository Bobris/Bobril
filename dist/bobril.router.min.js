!function(n,r){function e(){return n.invalidate(),!1}function a(n){r.location.hash=n,C++}function t(n){var e=r.location;e.replace(e.pathname+e.search+"#"+n)}function u(){C--,r.history.back()}function i(n){return encodeURIComponent(n).replace(/%20/g,"+")}function o(n){return decodeURIComponent(n.replace(/\+/g," "))}function l(n){return(n+"").split("/").map(i).join("/")}function c(n){if(!(n in O)){var r=[],e=n.replace(I,function(n,e){return e?(r.push(e),"([^/?#]+)"):"*"===n?(r.push("splat"),"(.*?)"):"\\"+n});O[n]={matcher:RegExp("^"+e+"$","i"),paramNames:r}}return O[n]}function f(n,r){var e=c(n),a=o(r).match(e.matcher);if(!a)return null;for(var t={},u=e.paramNames,i=u.length,l=0;i>l;l++)t[u[l]]=a[l+1];return t}function s(n,r){r=r||{};var e=0;return n.replace(M,function(a,t){if(t=t||"splat","?"!==t.slice(-1)){if(null==r[t])throw Error('Missing "'+t+'" parameter for path "'+n+'"')}else if(t=t.slice(0,-1),null==r[t])return"";var u;if("splat"===t&&Array.isArray(r[t])){if(u=r[t][e++],null==u)throw Error("Missing splat # "+e+' for path "'+n+'"')}else u=r[t];return l(u)})}function d(n,r,e){for(var a,t,u,i=r.length,o=0;i>o;o++){var l=r[o];if(l.isNotFound)a=l;else if(l.isDefault)t=l;else{if(l.children){var c=d(n,l.children,e);if(c)return c.push(l),c}if(l.url&&(u=f(l.url,n)))return e.p=u,[l]}}return t&&(u=f(t.url,n))?(e.p=u,[t]):a&&(u=f(a.url,n))?(e.p=u,[a]):null}function p(n){return!T.test(n)}function h(n){return"/"===n[0]}function m(){return null}function v(){var e=r.location.hash.substr(1);h(e)||(e="/"+e);var a={p:{}},t=d(e,F,a)||[];Z=t,_=a.p;for(var u=m,i=0;i<t.length;i++)!function(r,e,a){u=function(t){var u=e.data||{};n.assign(u,t),u.activeRouteHandler=r,u.routeParams=a;var i,o=e.handler;return i="function"==typeof o?o(u):{key:void 0,data:u,component:o},e.keyBuilder&&(i.key=e.keyBuilder(a)),i}}(u,t[i],_);return u()}function y(n,r){return h(r)?r:"/"===n[n.length-1]?n+r:n+"/"+r}function g(n,r){for(var e=r.length,a=0;e>a;a++){var t=r[a],u=n,i=t.name;i&&(P[i]=t,u=y(u,i)),t.isDefault?u=n:t.isNotFound?u=y(n,"*"):t.url&&(u=y(n,t.url)),t.url=u,t.children&&g(u,t.children)}}function k(r){n.isArray(r)||(r=[r]),g("/",r),F=r,n.init(v)}function A(n,r){return{name:n.name,url:n.url,data:n.data,handler:n.handler,keyBuilder:n.keyBuilder,children:r}}function B(n){return{name:n.name,data:n.data,handler:n.handler,keyBuilder:n.keyBuilder,isDefault:!0}}function N(n){return{name:n.name,data:n.data,handler:n.handler,keyBuilder:n.keyBuilder,isNotFound:!0}}function R(n,r){if(r)for(var e in r)if(r.hasOwnProperty(e)&&_[e]!==r[e])return!1;for(var a=0,t=Z.length;t>a;a++)if(Z[a].name===n)return!0;return!1}function w(n,r){if(p(n)){var e=P[n];return s(e.url,r)}return n}function $(r,e,a){return r.data=r.data||{},r.data.active=R(e,a),r.data.url=w(e,a),r.data.transition=b(e,a),n.postEnhance(r,{render:function(n,r){r.attrs=r.attrs||{},"a"===r.tag&&(r.attrs.href="#"+n.data.url),r.className=r.className||"",n.data.active&&(r.className+=" active")},onClick:function(n){return D(n.data.transition),!0}}),r}function b(n,r){return{inApp:p(n),type:0,name:n,params:r||{}}}function E(n,r){return{inApp:p(n),type:1,name:n,params:r||{}}}function z(){return{inApp:C>0,type:2,name:null,params:{}}}function D(n){switch(n.type){case 0:a(w(n.name,n.params));break;case 1:t(w(n.name,n.params));break;case 2:u()}}n.addEvent("hashchange",10,e);var F,Z,_,C=0,P={},I=/:([a-zA-Z_$][a-zA-Z0-9_$]*)|[*.()\[\]\\+|{}^$]/g,M=/:([a-zA-Z_$][a-zA-Z0-9_$?]*[?]?)|[*]/g,O={},T=/\:|\//g;n.routes=k,n.route=A,n.routeDefault=B,n.routeNotFound=N,n.isRouteActive=R,n.urlOfRoute=w,n.createRedirectPush=b,n.createRedirectReplace=E,n.createBackTransition=z,n.runTransition=D,n.link=$}(b,window);