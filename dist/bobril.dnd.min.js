!function(t){function e(){return{component:Y}}function n(t,e,n){var a=O[t.id];return a&&null==a.totalX&&a.cancelDnd(),1===t.button&&(O[t.id]={lastX:t.x,lastY:t.y,totalX:0,totalY:0,startX:t.x,startY:t.y,sourceNode:n}),!1}function a(e,n){n.targetCtx=t.bubble(e,"onDragOver",n),null==n.targetCtx&&(n.operation=0),t.broadcast("onDrag",n)}function r(t,e){t.shift=e.shift,t.ctrl=e.ctrl,t.alt=e.alt,t.meta=e.meta}function i(e,n,i){var l=O[e.id];if(l&&null==l.totalX)return l.x=e.x,l.y=e.y,r(l,e),a(i,l),!0;if(l&&null!=l.totalX&&(l.totalX+=Math.abs(e.x-l.lastX),l.totalY+=Math.abs(e.y-l.lastY),l.lastX=e.x,l.lastY=e.y,l.totalX+l.totalY>10)){i=l.sourceNode;var o=l.startX,d=l.startY;l=new X(e.id),l.startX=o,l.startY=d,l.x=e.x,l.y=e.y,r(l,e);var s=t.bubble(i,"onDragStart",l);if(s){var c=t.getDomNode(s.me);if(null==c)return l.destroy(),!1;var u=c.getBoundingClientRect;if(u){var f=u.call(c);l.deltaX=f.left-o,l.deltaY=f.top-d}return a(i,l),!0}l.destroy()}return!1}function l(e,n,i){var l=O[e.id];if(l&&null==l.totalX){l.x=e.x,l.y=e.y,r(l,e),a(i,l);var o=l.targetCtx;return o&&t.bubble(o.me,"onDrop",l)?(l.ended=!0,t.broadcast("onDragEnd",l),l.destroy()):l.cancelDnd(),!0}return l&&delete O[e.id],!1}function o(t){var e=O[t.id];return e&&null==e.totalX?e.cancelDnd():delete O[t.id],!1}function d(e,n){e.shift=n.shiftKey,e.ctrl=n.ctrlKey,e.alt=n.altKey,e.meta=n.metaKey,e.x=n.clientX,e.y=n.clientY;var r=t.nodeOnPoint(e.x,e.y);a(r,e)}function s(e,n,a){var r=b;null!=r&&r.destroy();for(var i=Object.keys(O),l=e.clientX,o=e.clientY,s=-1,c=0;c<i.length;c++)if(r=O[i[c]],null!=r.totalX){s=+i[c],l=r.startX,o=r.startY,delete O[s];break}r=new X(s),b=r,r.x=e.clientX,r.y=e.clientY,r.startX=l,r.startY=o;var u=t.bubble(a,"onDragStart",r);if(u){var f=t.getDomNode(u.me);if(null==f)return r.destroy(),!1;var h=f.getBoundingClientRect;if(h){var g=h.call(f);r.deltaX=g.left-l,r.deltaY=g.top-o}var v=k[r.enabledOperations],y=e.dataTransfer;if(y.effectAllowed=v,y.setDragImage){var p=document.createElement("div");p.style.pointerEvents="none",y.setDragImage(p,0,0)}else{var D=f.style,x=D.opacity,m=D.width,Y=D.height,w=D.padding;D.opacity="0",D.width="0",D.height="0",D.padding="0",window.setTimeout(function(){D.opacity=x,D.width=m,D.height=Y,D.padding=w},0)}for(var E=r.data,T=Object.keys(E),c=0;c<T.length;c++)try{var C=T[c],N=E[C];"string"!=typeof N&&(N=JSON.stringify(N)),e.dataTransfer.setData(C,N)}catch(j){}d(r,e)}else r.destroy();return!1}function c(t,e){t.dataTransfer.dropEffect=["none","link","copy","move"][e]}function u(t){var e=b;if(null==e){e=new X(-1),b=e,e.x=t.clientX,e.y=t.clientY,e.startX=e.x,e.startY=e.y,e.local=!1;var n=t.dataTransfer,a=0;try{var r=n.effectAllowed}catch(i){}for(;7>a&&k[a]!==r;a++);e.enabledOperations=a;var l=n.types;if(l)for(var o=0;o<l.length;o++){var s=l[o];"text/plain"===s?s="Text":"text/uri-list"===s&&(s="Url"),e.data[s]=null}else void 0!==n.getData("Text")&&(e.data.Text=null)}return d(e,t),c(t,e.operation),0!=e.operation?(x(t),!0):!1}function f(e){var n=e.clientX,a=e.clientY,r=t.getMedia();return null!=b&&(0===n&&0===a||0>n||0>a||n>=r.width||a>=r.height)&&(b.x=0,b.y=0,b.operation=0,t.broadcast("onDrag",b)),!1}function h(){return null!=b&&(b.ended=!0,t.broadcast("onDragEnd",b),b.cancelDnd()),!1}function g(e){var n=b;if(null==n)return!1;if(n.x=e.clientX,n.y=e.clientY,!n.local)for(var a=Object.keys(n.data),r=e.dataTransfer,i=0;i<a.length;i++){var l,o=a[i];"Files"===o?l=[].slice.call(r.files,0):(l=r.getData(o),"string"!=typeof l&&(l=JSON.parse(l))),n.data[o]=l}d(n,e);var s=n.targetCtx;return s&&t.bubble(s.me,"onDrop",n)?(c(e,n.operation),n.ended=!0,t.broadcast("onDragEnd",n),n.destroy(),x(e)):n.cancelDnd(),!0}function v(t){return x(t),!0}var y=0,p=[],b=null,D=null,x=t.preventDefault,X=function(n){this.id=++y,this.pointerid=n,this.enabledOperations=7,this.operation=0,this.local=!0,this.ended=!1,this.targetCtx=null,this.dragView=null,this.startX=0,this.startY=0,this.x=0,this.y=0,this.deltaX=0,this.deltaY=0,this.shift=!1,this.ctrl=!1,this.alt=!1,this.meta=!1,this.data=Object.create(null),n>=0&&(O[n]=this),p.push(this),null==D&&(D=t.addRoot(e))},m={render:function(t,e){var n=t.data;e.tag="div",e.style={position:"absolute",left:n.x,top:n.y},e.children=n.dragView(n)}},Y={render:function(t,e){for(var n=[],a=0;a<p.length;a++){var r=p[a];null==r.dragView||0==r.x&&0==r.y||n.push({key:""+r.id,data:r,component:m})}e.tag="div",e.style={position:"fixed",userSelect:"none",pointerEvents:"none",left:0,top:0,right:0,bottom:0},e.children=n},onDrag:function(e){return t.invalidate(e),!1}},w=X.prototype;w.setOperation=function(t){this.operation=t},w.setDragNodeView=function(t){this.dragView=t},w.addData=function(t,e){return this.data[t]=e,!0},w.listData=function(){return Object.keys(this.data)},w.hasData=function(t){return void 0!==this.data[t]},w.getData=function(t){return this.data[t]},w.setEnabledOps=function(t){this.enabledOperations=t},w.cancelDnd=function(){a(null,this),this.ended=!0,t.broadcast("onDragEnd",this),this.destroy()},w.destroy=function(){delete O[this.pointerid];for(var e=0;e<p.length;e++)if(p[e]===this){p.splice(e,1);break}b===this&&(b=null),0===p.length&&(t.removeRoot(D),D=null)};var O=Object.create(null),k=["none","link","copy","copyLink","move","linkMove","copyMove","all"],E=t.addEvent;E("!PointerDown",4,n),E("!PointerMove",4,i),E("!PointerUp",4,l),E("!PointerCancel",4,o),E("dragstart",5,s),E("dragover",5,u),E("dragend",5,h),E("drag",5,f),E("drop",5,g),E("dragenter",5,v),E("dragleave",5,v),t.getDnds=function(){return p}}(b);