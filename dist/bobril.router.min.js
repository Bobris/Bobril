!function(r,n){function t(){return r.invalidate(),!1}function a(r){$=w,n.location.hash=r}function e(r){return encodeURIComponent(r).replace(/%20/g,"+")}function u(r){return decodeURIComponent(r.replace(/\+/g," "))}function i(r){return(r+"").split("/").map(e).join("/")}function l(r){if(!(r in _)){var n=[],t=r.replace(R,function(r,t){return t?(n.push(t),"([^/?#]+)"):"*"===r?(n.push("splat"),"(.*?)"):"\\"+r});_[r]={matcher:RegExp("^"+t+"$","i"),paramNames:n}}return _[r]}function o(r,n){var t=l(r),a=u(n).match(t.matcher);if(!a)return null;for(var e={},i=t.paramNames,o=i.length,c=0;o>c;c++)e[i[c]]=a[c+1];return e}function c(r,n){n=n||{};var t=0;return r.replace(Z,function(a,e){if(e=e||"splat","?"!==e.slice(-1)){if(null==n[e])throw Error('Missing "'+e+'" parameter for path "'+r+'"')}else if(e=e.slice(0,-1),null==n[e])return"";var u;if("splat"===e&&Array.isArray(n[e])){if(u=n[e][t++],null==u)throw Error("Missing splat # "+t+' for path "'+r+'"')}else u=n[e];return i(u)})}function f(r,n,t){for(var a=n.length,e=0;a>e;e++){var u=n[e];if(u.children){var i=f(r,u.children,t);if(i)return i.push(u),i}if(u.url){var l=o(u.url,r);if(l)return t.p=l,[u]}}return null}function h(){var r=n.location.hash.substr(1);p(r)||(r="/"+r);for(var t={p:{}},a=f(r,E,t)||[],e=s,u=0;u<a.length;u++)!function(r,n,t){e=function(a){return a=a||{},a.activeRouteHandler=r,a.routeParams=t,{data:a,component:n.handler}}}(e,a[u],t.p);return e()}function s(){return null}function p(r){return"/"==r[0]}function d(r,n){return p(n)?n:"/"==r[r.length-1]?r+n:r+"/"+n}function v(r,n){for(var t=n.length,a=0;t>a;a++){var e=n[a],u=r,i=e.name;i&&(z[i]=e,u=d(u,i)),e.url&&(u=d(r,e.url)),e.url=u,e.children&&v(u,e.children)}}function m(n){r.isArray(n)||(n=[n]),v("/",n),E=n,r.init(h)}function g(r,n){return{name:r.name,url:r.url,handler:r.handler,children:n}}function A(n,t,e){var u=z[t],i=c(u.url,e);return n.data=n.data||{},n.data.url=i,r.postEnhance(n,{init:function(r,n){"a"==n.tag&&(n.attrs=n.attrs||{},n.attrs.href="#"+i)},onClick:function(r){return a(r.data.url),!0}}),n}r.addEvent("hashchange",100,t);var $,E,w=0,z={},R=/:([a-zA-Z_$][a-zA-Z0-9_$]*)|[*.()\[\]\\+|{}^$]/g,Z=/:([a-zA-Z_$][a-zA-Z0-9_$?]*[?]?)|[*]/g,_={};r.routes=m,r.route=g,r.link=A}(b,window);