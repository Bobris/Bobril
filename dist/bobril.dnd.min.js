!function(t){function n(){return{component:h}}function e(t,n,e){var a=b[t.id];return a&&null==a.totalX&&a.cancelDnd(),b[t.id]={lastX:t.x,lastY:t.y,totalX:0,totalY:0,startX:t.x,startY:t.y,sourceNode:e},!1}function a(n,e){e.targetCtx=t.bubble(n,"onDragOver",e),null==e.targetCtx&&(e.operation=0),t.broadcast("onDrag",e)}function i(n,e,i){var r=b[n.id];if(r&&null==r.totalX)return r.x=n.x,r.y=n.y,a(i,r),!0;if(r&&null!=r.totalX&&(r.totalX+=Math.abs(n.x-r.lastX),r.totalY+=Math.abs(n.y-r.lastY),r.lastX=n.x,r.lastY=n.y,r.totalX+r.totalY>20)){i=r.sourceNode;var o=r.startX,l=r.startY;r=new u(n.id),r.x=n.x,r.y=n.y;var d=t.bubble(i,"onDragStart",r);if(d){var s=t.getDomNode(d.me);if(null==s)return r.destroy(),!1;var c=s.getBoundingClientRect;if(c){var h=c.call(s);r.deltaX=h.left-o,r.deltaY=h.top-l}return a(i,r),!0}r.destroy()}return!1}function r(n,e,i){var r=b[n.id];if(r&&null==r.totalX){r.x=n.x,r.y=n.y,a(i,r);var o=r.targetCtx;return o&&t.bubble(o.me,"onDrop",r)?(t.broadcast("onDragEnd",this),a(null,r),r.destroy()):r.cancelDnd(),!0}return r&&delete b[n.id],!1}function o(t){var n=b[t.id];return n&&null==n.totalX?n.cancelDnd():delete b[t.id],!1}var l=0,d=[],s=null,u=function(e){this.id=++l,this.pointerid=e,this.linkEnabled=!0,this.copyEnabled=!0,this.moveEnabled=!0,this.operation=0,this.targetCtx=null,this.dragView=null,this.x=0,this.y=0,this.deltaX=0,this.deltaY=0,this.shift=!1,this.ctrl=!1,this.alt=!1,this.meta=!1,this.data=Object.create(null),e>=0&&(b[e]=this),d.push(this),null==s&&(s=t.addRoot(n))},c={render:function(t,n){var e=t.data;n.tag="div",n.style={position:"absolute",left:e.x,top:e.y},n.children=e.dragView(e)}},h={render:function(t,n){for(var e=[],a=0;a<d.length;a++){var i=d[a];null!=i.dragView&&e.push({key:""+i.id,data:i,component:c})}n.tag="div",n.style={position:"fixed",pointerEvents:"none",left:0,top:0,right:0,bottom:0},n.children=e},onDrag:function(n){return t.invalidate(n),!1}},f=u.prototype;f.setOperation=function(t){this.operation=t},f.setDragNodeView=function(t){this.dragView=t},f.addData=function(t,n){return this.data[t]=n,!0},f.hasData=function(t){return void 0!==this.data[t]},f.getData=function(t){return this.data[t]},f.setOpEnabled=function(t,n,e){this.linkEnabled=t,this.copyEnabled=n,this.moveEnabled=e},f.cancelDnd=function(){a(null,this),t.broadcast("onDragEnd",this),this.destroy()},f.destroy=function(){delete b[this.pointerid];for(var n=0;n<d.length;n++)if(d[n]===this){d.splice(n,1);break}0===d.length&&(t.removeRoot(s),s=null)};var b=Object.create(null),v=t.addEvent;v("!PointerDown",4,e),v("!PointerMove",4,i),v("!PointerUp",4,r),v("!PointerCancel",4,o),t.getDnds=function(){return d}}(b);