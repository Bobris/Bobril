!function(r,n){function t(){return r.invalidate(),!1}function e(r){A=z,n.location.hash=r}function a(r){return encodeURIComponent(r).replace(/%20/g,"+")}function u(r){return decodeURIComponent(r.replace(/\+/g," "))}function i(r){return(r+"").split("/").map(a).join("/")}function l(r){if(!(r in Z)){var n=[],t=r.replace(F,function(r,t){return t?(n.push(t),"([^/?#]+)"):"*"===r?(n.push("splat"),"(.*?)"):"\\"+r});Z[r]={matcher:RegExp("^"+t+"$","i"),paramNames:n}}return Z[r]}function o(r,n){var t=l(r),e=u(n).match(t.matcher);if(!e)return null;for(var a={},i=t.paramNames,o=i.length,c=0;o>c;c++)a[i[c]]=e[c+1];return a}function c(r,n){n=n||{};var t=0;return r.replace(R,function(e,a){if(a=a||"splat","?"!==a.slice(-1)){if(null==n[a])throw Error('Missing "'+a+'" parameter for path "'+r+'"')}else if(a=a.slice(0,-1),null==n[a])return"";var u;if("splat"===a&&Array.isArray(n[a])){if(u=n[a][t++],null==u)throw Error("Missing splat # "+t+' for path "'+r+'"')}else u=n[a];return i(u)})}function f(r,n,t){for(var e,a,u,i=n.length,l=0;i>l;l++){var c=n[l];if(c.isNotFound)e=c;else if(c.isDefault)a=c;else{if(c.children){var s=f(r,c.children,t);if(s)return s.push(c),s}if(c.url&&(u=o(c.url,r)))return t.p=u,[c]}}return a&&(u=o(a.url,r))?(t.p=u,[a]):e&&(u=o(e.url,r))?(t.p=u,[e]):null}function s(r){return"/"===r[0]}function d(){return null}function h(){var t=n.location.hash.substr(1);s(t)||(t="/"+t);var e={p:{}},a=f(t,$,e)||[];w=a,E=e.p;for(var u=d,i=0;i<a.length;i++)!function(n,t,e){u=function(a){var u=t.data||{};return r.assign(u,a),u.activeRouteHandler=n,u.routeParams=e,{key:t.keyBuilder?t.keyBuilder(e):void 0,data:u,component:t.handler}}}(u,a[i],E);return u()}function p(r,n){return s(n)?n:"/"===r[r.length-1]?r+n:r+"/"+n}function v(r,n){for(var t=n.length,e=0;t>e;e++){var a=n[e],u=r,i=a.name;i&&(D[i]=a,u=p(u,i)),a.isDefault?u=r:a.isNotFound?u=p(r,"*"):a.url&&(u=p(r,a.url)),a.url=u,a.children&&v(u,a.children)}}function m(n){r.isArray(n)||(n=[n]),v("/",n),$=n,r.init(h)}function g(r,n){return{name:r.name,url:r.url,data:r.data,handler:r.handler,keyBuilder:r.keyBuilder,children:n}}function y(r){return{name:r.name,data:r.data,handler:r.handler,keyBuilder:r.keyBuilder,isDefault:!0}}function k(r){return{name:r.name,data:r.data,handler:r.handler,keyBuilder:r.keyBuilder,isNotFound:!0}}function N(r,n){if(n)for(var t in n)if(n.hasOwnProperty(t)&&E[t]!==n[t])return!1;for(var e=0,a=w.length;a>e;e++)if(w[e].name===r)return!0;return!1}function B(n,t,a){var u=D[t],i=c(u.url,a);return n.data=n.data||{},n.data.active=N(t,a),n.data.url=i,r.postEnhance(n,{render:function(r,n){n.attrs=n.attrs||{},"a"===n.tag&&(n.attrs.href="#"+i),n.attrs.className=n.attrs.className||"",r.data.active&&(n.attrs.className+=" active")},onClick:function(r){return e(r.data.url),!0}}),n}r.addEvent("hashchange",100,t);var A,$,w,E,z=0,D={},F=/:([a-zA-Z_$][a-zA-Z0-9_$]*)|[*.()\[\]\\+|{}^$]/g,R=/:([a-zA-Z_$][a-zA-Z0-9_$?]*[?]?)|[*]/g,Z={};r.routes=m,r.route=g,r.routeDefault=y,r.routeNotFound=k,r.link=B}(b,window);