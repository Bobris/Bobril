!function(n,e){function r(){return n.invalidate(),!1}function t(n){e.location.hash=n,M++}function a(n){var r=e.location;r.replace(r.pathname+r.search+"#"+n)}function i(){M--,e.history.back()}function u(n){return encodeURIComponent(n).replace(/%20/g,"+")}function l(n){return decodeURIComponent(n.replace(/\+/g," "))}function o(n){return(n+"").split("/").map(u).join("/")}function c(n){if(!(n in j)){var e=[],r=n.replace(T,function(n,r){return r?(e.push(r),"([^/?#]+)"):"*"===n?(e.push("splat"),"(.*?)"):"\\"+n});j[n]={matcher:RegExp("^"+r+"$","i"),paramNames:e}}return j[n]}function f(n,e){var r=c(n),t=l(e).match(r.matcher);if(!t)return null;for(var a={},i=r.paramNames,u=i.length,o=0;u>o;o++)a[i[o]]=t[o+1];return a}function s(n,e){e=e||{};var r=0;return n.replace(U,function(t,a){if(a=a||"splat","?"!==a.slice(-1)){if(null==e[a])throw Error('Missing "'+a+'" parameter for path "'+n+'"')}else if(a=a.slice(0,-1),null==e[a])return"";var i;if("splat"===a&&Array.isArray(e[a])){if(i=e[a][r++],null==i)throw Error("Missing splat # "+r+' for path "'+n+'"')}else i=e[a];return o(i)})}function p(n,e,r){for(var t,a,i,u=e.length,l=0;u>l;l++){var o=e[l];if(o.isNotFound)t=o;else if(o.isDefault)a=o;else{if(o.children){var c=p(n,o.children,r);if(c)return c.push(o),c}if(o.url&&(i=f(o.url,n)))return r.p=i,[o]}}return a&&(i=f(a.url,n))?(r.p=i,[a]):t&&(i=f(t.url,n))?(r.p=i,[t]):null}function d(n){return!G.test(n)}function h(n){return"/"===n[0]}function v(){return null}function m(n){for(;n>=q.length;)q.push(function(n,e){return function(r){return n[e]=r}}(H,n));return q[n]}function g(){var r=e.location.hash.substr(1);h(r)||(r="/"+r);var t={p:{}},a=p(r,_,t)||[];for(J&&(J=!1,K={inApp:!0,type:2,name:null,params:null},Q=-1),C=a;H.length>C.length;)H.pop();for(;H.length<C.length;)H.push(null);if(I=t.p,K&&2===K.type&&0>Q)return K.inApp=!0,null==K.name&&C.length>0&&(K.name=C[0].name,K.params=I,F()),null;for(var i=v,u=0;u<a.length;u++)!function(e,r,t){i=function(a){var i=r.data||{};n.assign(i,a),i.activeRouteHandler=e,i.routeParams=t;var l,o=r.handler;return l="function"==typeof o?o(i):{key:void 0,ref:void 0,data:i,component:o},r.keyBuilder&&(l.key=r.keyBuilder(t)),l.ref=m(u),l}}(i,a[u],I);return i()}function y(n,e){return h(e)?e:"/"===n[n.length-1]?n+e:n+"/"+e}function k(n,e){for(var r=e.length,t=0;r>t;t++){var a=e[t],i=n,u=a.name;u&&(O[u]=a,i=y(i,u)),a.isDefault?i=n:a.isNotFound?i=y(n,"*"):a.url&&(i=y(n,a.url)),a.url=i,a.children&&k(i,a.children)}}function A(e){n.isArray(e)||(e=[e]),k("/",e),_=e,n.init(g)}function B(n,e){return{name:n.name,url:n.url,data:n.data,handler:n.handler,keyBuilder:n.keyBuilder,children:e}}function N(n){return{name:n.name,data:n.data,handler:n.handler,keyBuilder:n.keyBuilder,isDefault:!0}}function R(n){return{name:n.name,data:n.data,handler:n.handler,keyBuilder:n.keyBuilder,isNotFound:!0}}function b(n,e){if(e)for(var r in e)if(e.hasOwnProperty(r)&&I[r]!==e[r])return!1;for(var t=0,a=C.length;a>t;t++)if(C[t].name===n)return!0;return!1}function w(n,e){if(d(n)){var r=O[n];return s(r.url,e)}return n}function $(e,r,t){return e.data=e.data||{},e.data.active=b(r,t),e.data.url=w(r,t),e.data.transition=D(r,t),n.postEnhance(e,{render:function(n,e){e.attrs=e.attrs||{},"a"===e.tag&&(e.attrs.href="#"+n.data.url),e.className=e.className||"",n.data.active&&(e.className+=" active")},onClick:function(n){return Z(n.data.transition),!0}}),e}function D(n,e){return{inApp:d(n),type:0,name:n,params:e||{}}}function E(n,e){return{inApp:d(n),type:1,name:n,params:e||{}}}function P(){return{inApp:M>0,type:2,name:null,params:{}}}function z(e){switch(e.type){case 0:t(w(e.name,e.params));break;case 1:a(w(e.name,e.params));break;case 2:i()}n.invalidate()}function F(){for(;;){if(Q>=0&&Q<C.length){var e=H[Q];if(Q++,!e)continue;var r=e.component;if(!r)continue;var a=r.canDeactivate;if(!a)continue;var i=a.call(r,e.ctx,K);return void Promise.resolve(i).then(function(n){if(n===!0);else{if(n===!1)return K=null,void(L=null);L=n}F()})["catch"](console.log.bind(console))}if(Q==C.length){if(L&&(K&&0==K.type&&t(w(K.name,K.params)),K=L,L=null),Q=-1,!K.inApp||2===K.type)return void z(K)}else{if(-1!==Q){if(Q===-2-x.length){if(L){Q=C.length;continue}return 2!==K.type?z(K):n.invalidate(),void(K=null)}if(L){Q=C.length;continue}var u=x[x.length+1+Q];Q--;var l=u.handler,r=null;if("function"==typeof l){var e=l({});if(!e)continue;r=e.component}else r=l;if(!r)continue;var a=r.canActivate;if(!a)continue;var i=a.call(r,K);return void Promise.resolve(i).then(function(n){if(n===!0);else{if(n===!1)return K=null,void(L=null);L=n}F()})["catch"](console.log.bind(console))}var o={p:{}},c=p(w(K.name,K.params),_,o)||[];x=c,Q=-2}}}function Z(n){return null!=K?void(L=n):(J=!1,K=n,Q=0,void F())}n.addEvent("hashchange",10,r);var _,C,x,I,M=0,O={},T=/:([a-zA-Z_$][a-zA-Z0-9_$]*)|[*.()\[\]\\+|{}^$]/g,U=/:([a-zA-Z_$][a-zA-Z0-9_$?]*[?]?)|[*]/g,j={},H=[],q=[],G=/\:|\//g,J=!0,K=null,L=null,Q=0;n.routes=A,n.route=B,n.routeDefault=N,n.routeNotFound=R,n.isRouteActive=b,n.urlOfRoute=w,n.createRedirectPush=D,n.createRedirectReplace=E,n.createBackTransition=P,n.runTransition=Z,n.link=$}(b,window);