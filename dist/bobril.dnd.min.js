!function(t){function e(){return{component:x}}function n(t,e,n){var a=m[t.id];return a&&null==a.totalX&&a.cancelDnd(),m[t.id]={lastX:t.x,lastY:t.y,totalX:0,totalY:0,startX:t.x,startY:t.y,sourceNode:n},!1}function a(e,n){n.targetCtx=t.bubble(e,"onDragOver",n),null==n.targetCtx&&(n.operation=0),t.broadcast("onDrag",n)}function r(e,n,r){var o=m[e.id];if(o&&null==o.totalX)return o.x=e.x,o.y=e.y,a(r,o),!0;if(o&&null!=o.totalX&&(o.totalX+=Math.abs(e.x-o.lastX),o.totalY+=Math.abs(e.y-o.lastY),o.lastX=e.x,o.lastY=e.y,o.totalX+o.totalY>20)){r=o.sourceNode;var l=o.startX,i=o.startY;o=new D(e.id),o.startX=l,o.startY=i,o.x=e.x,o.y=e.y;var d=t.bubble(r,"onDragStart",o);if(d){var s=t.getDomNode(d.me);if(null==s)return o.destroy(),!1;var c=s.getBoundingClientRect;if(c){var u=c.call(s);o.deltaX=u.left-l,o.deltaY=u.top-i}return a(r,o),!0}o.destroy()}return!1}function o(e,n,r){var o=m[e.id];if(o&&null==o.totalX){o.x=e.x,o.y=e.y,a(r,o);var l=o.targetCtx;return l&&t.bubble(l.me,"onDrop",o)?(o.ended=!0,t.broadcast("onDragEnd",o),a(null,o),o.destroy()):o.cancelDnd(),!0}return o&&delete m[e.id],!1}function l(t){var e=m[t.id];return e&&null==e.totalX?e.cancelDnd():delete m[t.id],!1}function i(t,e){t.shift=e.shiftKey,t.ctrl=e.ctrlKey,t.alt=e.altKey,t.meta=e.metaKey}function d(t){return"Text"==t||"Url"==t||"Files"==t}function s(e,n,r){var o=p;null!=o&&o.destroy();for(var l=Object.keys(m),s=e.clientX,c=e.clientY,u=-1,f=0;f<l.length;f++)if(o=m[l[f]],null!=o.totalX){u=+l[f],s=o.startX,c=o.startY,delete m[u];break}o=new D(u),p=o,o.x=e.clientX,o.y=e.clientY,o.startX=s,o.startY=c;var h=t.bubble(r,"onDragStart",o);if(h){var v=t.getDomNode(h.me);if(null==v)return o.destroy(),!1;var g=v.getBoundingClientRect;if(g){var y=g.call(v);o.deltaX=y.left-s,o.deltaY=y.top-c}var b=O[o.enabledOperations];e.dataTransfer.effectAllowed=b;var X=document.createElement("div");X.style.pointerEvents="none",e.dataTransfer.setDragImage(X,0,0);for(var x=o.data,Y=Object.keys(x),f=0;f<Y.length;f++)try{var w=Y[f],k=x[w];e.dataTransfer.setData(w,d(w)?k:JSON.stringify(k))}catch(E){console.log("Cannot set dnd data to "+Y[f])}i(o,e),a(r,o)}else o.destroy();return!1}function c(e,n,r){var o=p;if(null==o){o=new D(-1),p=o,o.x=e.clientX,o.y=e.clientY,o.startX=o.x,o.startY=o.y,o.local=!1;for(var l=e.dataTransfer,d=0;7>d&&O[d]!==l.effectAllowed;d++);o.enabledOperations=d;for(var s=0;s<l.types.length;s++)o.data[l.types[s]]=null}return i(o,e),o.x=e.clientX,o.y=e.clientY,r=t.nodeOnPoint(o.x,o.y),a(r,o),e.dataTransfer.dropEffect=["none","link","copy","move"][o.operation],0!=o.operation?(t.preventDefault(e),!0):!1}function u(e){var n=e.clientX,a=e.clientY,r=t.getMedia();return null!=p&&(0===n&&0===a||0>n||0>a||n>=r.width||a>=r.height)&&(p.x=0,p.y=0,p.operation=0,t.broadcast("onDrag",p)),!1}function f(){return null!=p&&(p.ended=!0,t.broadcast("onDragEnd",p),p.cancelDnd()),!1}function h(e,n,r){var o=p;if(null==o)return!1;if(o.x=e.clientX,o.y=e.clientY,!o.local)for(var l=Object.keys(o.data),s=e.dataTransfer,c=0;c<l.length;c++){var u=l[c],f=s.getData(u);d(u)||(f=JSON.parse(f)),o.data[u]=f}a(r,o),i(o,e);var h=o.targetCtx;return h&&t.bubble(h.me,"onDrop",o)?(e.dataTransfer.dropEffect=["none","link","copy","move"][o.operation],o.ended=!0,t.broadcast("onDragEnd",o),o.destroy(),t.preventDefault(e)):o.cancelDnd(),!0}function v(e){return t.preventDefault(e),!0}var g=0,y=[],p=null,b=null,D=function(n){this.id=++g,this.pointerid=n,this.enanbledOperations=7,this.operation=0,this.local=!0,this.ended=!1,this.targetCtx=null,this.dragView=null,this.startX=0,this.startY=0,this.x=0,this.y=0,this.deltaX=0,this.deltaY=0,this.shift=!1,this.ctrl=!1,this.alt=!1,this.meta=!1,this.data=Object.create(null),n>=0&&(m[n]=this),y.push(this),null==b&&(b=t.addRoot(e))},X={render:function(t,e){var n=t.data;e.tag="div",e.style={position:"absolute",left:n.x,top:n.y},e.children=n.dragView(n)}},x={render:function(t,e){for(var n=[],a=0;a<y.length;a++){var r=y[a];null==r.dragView||0==r.x&&0==r.y||n.push({key:""+r.id,data:r,component:X})}e.tag="div",e.style={position:"fixed",pointerEvents:"none",left:0,top:0,right:0,bottom:0},e.children=n},onDrag:function(e){return t.invalidate(e),!1}},Y=D.prototype;Y.setOperation=function(t){this.operation=t},Y.setDragNodeView=function(t){this.dragView=t},Y.addData=function(t,e){return this.data[t]=e,!0},Y.hasData=function(t){return void 0!==this.data[t]},Y.getData=function(t){return this.data[t]},Y.setEnabledOps=function(t){this.enabledOperations=t},Y.cancelDnd=function(){a(null,this),this.ended=!0,t.broadcast("onDragEnd",this),this.destroy()},Y.destroy=function(){delete m[this.pointerid];for(var e=0;e<y.length;e++)if(y[e]===this){y.splice(e,1);break}p===this&&(p=null),0===y.length&&(t.removeRoot(b),b=null)};var m=Object.create(null),O=["none","link","copy","copyLink","move","linkMove","copyMove","all"],w=t.addEvent;w("!PointerDown",4,n),w("!PointerMove",4,r),w("!PointerUp",4,o),w("!PointerCancel",4,l),w("dragstart",5,s),w("dragover",5,c),w("dragend",5,f),w("drag",5,u),w("drop",5,h),w("dragenter",5,v),w("dragleave",5,v),t.getDnds=function(){return y}}(b);