!function(n,e){function r(){return n.invalidate(),!1}function t(n){e.location.hash=n,I++}function a(n){var r=e.location;r.replace(r.pathname+r.search+"#"+n)}function i(){I--,e.history.back()}function u(n){return encodeURIComponent(n).replace(/%20/g,"+")}function o(n){return decodeURIComponent(n.replace(/\+/g," "))}function l(n){return(n+"").split("/").map(u).join("/")}function c(n){if(!(n in U)){var e=[],r=n.replace(O,function(n,r){return r?(e.push(r),"([^/?#]+)"):"*"===n?(e.push("splat"),"(.*?)"):"\\"+n});U[n]={matcher:RegExp("^"+r+"$","i"),paramNames:e}}return U[n]}function f(n,e){var r=c(n),t=o(e).match(r.matcher);if(!t)return null;for(var a={},i=r.paramNames,u=i.length,l=0;u>l;l++)a[i[l]]=t[l+1];return a}function s(n,e){e=e||{};var r=0;return n.replace(T,function(t,a){if(a=a||"splat","?"!==a.slice(-1)){if(null==e[a])throw Error('Missing "'+a+'" parameter for path "'+n+'"')}else if(a=a.slice(0,-1),null==e[a])return"";var i;if("splat"===a&&Array.isArray(e[a])){if(i=e[a][r++],null==i)throw Error("Missing splat # "+r+' for path "'+n+'"')}else i=e[a];return l(i)})}function d(n,e,r){for(var t,a,i,u=e.length,o=0;u>o;o++){var l=e[o];if(l.isNotFound)t=l;else if(l.isDefault)a=l;else{if(l.children){var c=d(n,l.children,r);if(c)return c.push(l),c}if(l.url&&(i=f(l.url,n)))return r.p=i,[l]}}return a&&(i=f(a.url,n))?(r.p=i,[a]):t&&(i=f(t.url,n))?(r.p=i,[t]):null}function p(n){return!H.test(n)}function h(n){return"/"===n[0]}function v(){return null}function m(){var r=e.location.hash.substr(1);h(r)||(r="/"+r);var t={p:{}},a=d(r,Z,t)||[];if(_=a,x=t.p,q&&2===q.type&&0>J)return q.inApp=!0,null==q.name&&_.length>0&&(q.name=_[0].name,q.params=x,z()),null;for(var i=v,u=0;u<a.length;u++)!function(e,r,t){i=function(a){var i=r.data||{};n.assign(i,a),i.activeRouteHandler=e,i.routeParams=t;var u,o=r.handler;return u="function"==typeof o?o(i):{key:void 0,ref:void 0,data:i,component:o},r.keyBuilder&&(u.key=r.keyBuilder(t)),u.ref=[j,r.name],u}}(i,a[u],x);return i()}function g(n,e){return h(e)?e:"/"===n[n.length-1]?n+e:n+"/"+e}function y(n,e){for(var r=e.length,t=0;r>t;t++){var a=e[t],i=n,u=a.name;u&&(M[u]=a,i=g(i,u)),a.isDefault?i=n:a.isNotFound?i=g(n,"*"):a.url&&(i=g(n,a.url)),a.url=i,a.children&&y(i,a.children)}}function k(e){n.isArray(e)||(e=[e]),y("/",e),Z=e,n.init(m)}function A(n,e){return{name:n.name,url:n.url,data:n.data,handler:n.handler,keyBuilder:n.keyBuilder,children:e}}function B(n){return{name:n.name,data:n.data,handler:n.handler,keyBuilder:n.keyBuilder,isDefault:!0}}function N(n){return{name:n.name,data:n.data,handler:n.handler,keyBuilder:n.keyBuilder,isNotFound:!0}}function R(n,e){if(e)for(var r in e)if(e.hasOwnProperty(r)&&x[r]!==e[r])return!1;for(var t=0,a=_.length;a>t;t++)if(_[t].name===n)return!0;return!1}function b(n,e){if(p(n)){var r=M[n];return s(r.url,e)}return n}function w(e,r,t){return e.data=e.data||{},e.data.active=R(r,t),e.data.url=b(r,t),e.data.transition=$(r,t),n.postEnhance(e,{render:function(n,e){e.attrs=e.attrs||{},"a"===e.tag&&(e.attrs.href="#"+n.data.url),e.className=e.className||"",n.data.active&&(e.className+=" active")},onClick:function(n){return F(n.data.transition),!0}}),e}function $(n,e){return{inApp:p(n),type:0,name:n,params:e||{}}}function D(n,e){return{inApp:p(n),type:1,name:n,params:e||{}}}function E(){return{inApp:I>0,type:2,name:null,params:{}}}function P(n){switch(n.type){case 0:t(b(n.name,n.params));break;case 1:a(b(n.name,n.params));break;case 2:i()}}function z(){for(;;){if(J>=0&&J<_.length){var n=_[J].name;J++;var e=j.refs[n];if(!e)continue;var r=e.component;if(!r)continue;var t=r.canDeactivate;if(!t)continue;var a=t.call(r,e.ctx,q);return void Promise.resolve(a).then(function(n){if(n===!0);else{if(n===!1)return q=null,void(G=null);G=n}z()})["catch"](console.log.bind(console))}if(J==_.length){if(G&&(q=G,G=null),J=-1,!q.inApp||2===q.type)return void P(q)}else{if(-1!==J){if(J===-2-C.length){if(G){J=_.length;continue}return 2!==q.type&&P(q),void(q=null)}if(G){J=_.length;continue}var n=C[C.length+1+J].name;J--;var e=j.refs[n];if(!e)continue;var r=e.component;if(!r)continue;var t=r.canActivate;if(!t)continue;var a=t.call(r,q);return void Promise.resolve(a).then(function(n){if(n===!0);else{if(n===!1)return q=null,void(G=null);G=n}z()})["catch"](console.log.bind(console))}var i={p:{}},u=d(b(q.name,q.params),Z,i)||[];C=u,J=-2}}}function F(n){return null!=q?void(G=n):(q=n,J=0,void z())}n.addEvent("hashchange",10,r);var Z,_,C,x,I=0,M={},O=/:([a-zA-Z_$][a-zA-Z0-9_$]*)|[*.()\[\]\\+|{}^$]/g,T=/:([a-zA-Z_$][a-zA-Z0-9_$?]*[?]?)|[*]/g,U={},j={},H=/\:|\//g,q=null,G=null,J=0;n.routes=k,n.route=A,n.routeDefault=B,n.routeNotFound=N,n.isRouteActive=R,n.urlOfRoute=b,n.createRedirectPush=$,n.createRedirectReplace=D,n.createBackTransition=E,n.runTransition=F,n.link=w}(b,window);