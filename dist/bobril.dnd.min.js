!function(t){function e(){return{component:Y}}function n(t,e,n){var a=w[t.id];return a&&null==a.totalX&&a.cancelDnd(),w[t.id]={lastX:t.x,lastY:t.y,totalX:0,totalY:0,startX:t.x,startY:t.y,sourceNode:n},!1}function a(e,n){n.targetCtx=t.bubble(e,"onDragOver",n),null==n.targetCtx&&(n.operation=0),t.broadcast("onDrag",n)}function r(e,n,r){var i=w[e.id];if(i&&null==i.totalX)return i.x=e.x,i.y=e.y,a(r,i),!0;if(i&&null!=i.totalX&&(i.totalX+=Math.abs(e.x-i.lastX),i.totalY+=Math.abs(e.y-i.lastY),i.lastX=e.x,i.lastY=e.y,i.totalX+i.totalY>10)){r=i.sourceNode;var l=i.startX,o=i.startY;i=new x(e.id),i.startX=l,i.startY=o,i.x=e.x,i.y=e.y;var d=t.bubble(r,"onDragStart",i);if(d){var s=t.getDomNode(d.me);if(null==s)return i.destroy(),!1;var c=s.getBoundingClientRect;if(c){var u=c.call(s);i.deltaX=u.left-l,i.deltaY=u.top-o}return a(r,i),!0}i.destroy()}return!1}function i(e,n,r){var i=w[e.id];if(i&&null==i.totalX){i.x=e.x,i.y=e.y,a(r,i);var l=i.targetCtx;return l&&t.bubble(l.me,"onDrop",i)?(i.ended=!0,t.broadcast("onDragEnd",i),i.destroy()):i.cancelDnd(),!0}return i&&delete w[e.id],!1}function l(t){var e=w[t.id];return e&&null==e.totalX?e.cancelDnd():delete w[t.id],!1}function o(e,n){e.shift=n.shiftKey,e.ctrl=n.ctrlKey,e.alt=n.altKey,e.meta=n.metaKey,e.x=n.clientX,e.y=n.clientY;var r=t.nodeOnPoint(e.x,e.y);a(r,e)}function d(e,n,a){var r=p;null!=r&&r.destroy();for(var i=Object.keys(w),l=e.clientX,d=e.clientY,s=-1,c=0;c<i.length;c++)if(r=w[i[c]],null!=r.totalX){s=+i[c],l=r.startX,d=r.startY,delete w[s];break}r=new x(s),p=r,r.x=e.clientX,r.y=e.clientY,r.startX=l,r.startY=d;var u=t.bubble(a,"onDragStart",r);if(u){var f=t.getDomNode(u.me);if(null==f)return r.destroy(),!1;var h=f.getBoundingClientRect;if(h){var g=h.call(f);r.deltaX=g.left-l,r.deltaY=g.top-d}var v=O[r.enabledOperations],y=e.dataTransfer;if(y.effectAllowed=v,y.setDragImage){var b=document.createElement("div");b.style.pointerEvents="none",y.setDragImage(b,0,0)}else{var D=f.style,X=D.opacity,Y=D.width,m=D.height,k=D.padding;D.opacity="0",D.width="0",D.height="0",D.padding="0",window.setTimeout(function(){D.opacity=X,D.width=Y,D.height=m,D.padding=k},0)}for(var E=r.data,T=Object.keys(E),c=0;c<T.length;c++)try{var C=T[c],N=E[C];"string"!=typeof N&&(N=JSON.stringify(N)),e.dataTransfer.setData(C,N)}catch(j){}o(r,e)}else r.destroy();return!1}function s(t,e){t.dataTransfer.dropEffect=["none","link","copy","move"][e]}function c(t){var e=p;if(null==e){e=new x(-1),p=e,e.x=t.clientX,e.y=t.clientY,e.startX=e.x,e.startY=e.y,e.local=!1;var n=t.dataTransfer,a=0;try{var r=n.effectAllowed}catch(i){}for(;7>a&&O[a]!==r;a++);e.enabledOperations=a;var l=n.types;if(l)for(var d=0;d<l.length;d++){var c=l[d];"text/plain"===c?c="Text":"text/uri-list"===c&&(c="Url"),e.data[c]=null}else void 0!==n.getData("Text")&&(e.data.Text=null)}return o(e,t),s(t,e.operation),0!=e.operation?(D(t),!0):!1}function u(e){var n=e.clientX,a=e.clientY,r=t.getMedia();return null!=p&&(0===n&&0===a||0>n||0>a||n>=r.width||a>=r.height)&&(p.x=0,p.y=0,p.operation=0,t.broadcast("onDrag",p)),!1}function f(){return null!=p&&(p.ended=!0,t.broadcast("onDragEnd",p),p.cancelDnd()),!1}function h(e){var n=p;if(null==n)return!1;if(n.x=e.clientX,n.y=e.clientY,!n.local)for(var a=Object.keys(n.data),r=e.dataTransfer,i=0;i<a.length;i++){var l,d=a[i];"Files"===d?l=[].slice.call(r.files,0):(l=r.getData(d),"string"!=typeof l&&(l=JSON.parse(l))),n.data[d]=l}o(n,e);var c=n.targetCtx;return c&&t.bubble(c.me,"onDrop",n)?(s(e,n.operation),n.ended=!0,t.broadcast("onDragEnd",n),n.destroy(),D(e)):n.cancelDnd(),!0}function g(t){return D(t),!0}var v=0,y=[],p=null,b=null,D=t.preventDefault,x=function(n){this.id=++v,this.pointerid=n,this.enanbledOperations=7,this.operation=0,this.local=!0,this.ended=!1,this.targetCtx=null,this.dragView=null,this.startX=0,this.startY=0,this.x=0,this.y=0,this.deltaX=0,this.deltaY=0,this.shift=!1,this.ctrl=!1,this.alt=!1,this.meta=!1,this.data=Object.create(null),n>=0&&(w[n]=this),y.push(this),null==b&&(b=t.addRoot(e))},X={render:function(t,e){var n=t.data;e.tag="div",e.style={position:"absolute",left:n.x,top:n.y},e.children=n.dragView(n)}},Y={render:function(e,n){for(var a=[],r=0;r<y.length;r++){var i=y[r];null==i.dragView||0==i.x&&0==i.y||a.push({key:""+i.id,data:i,component:X})}n.tag="div",n.style={position:"fixed",pointerEvents:"none",left:0,top:0,right:0,bottom:0},t.ieVersion()<10&&(n.attrs={unselectable:"on"}),n.children=a},onDrag:function(e){return t.invalidate(e),!1}},m=x.prototype;m.setOperation=function(t){this.operation=t},m.setDragNodeView=function(t){this.dragView=t},m.addData=function(t,e){return this.data[t]=e,!0},m.listData=function(){return Object.keys(this.data)},m.hasData=function(t){return void 0!==this.data[t]},m.getData=function(t){return this.data[t]},m.setEnabledOps=function(t){this.enabledOperations=t},m.cancelDnd=function(){a(null,this),this.ended=!0,t.broadcast("onDragEnd",this),this.destroy()},m.destroy=function(){delete w[this.pointerid];for(var e=0;e<y.length;e++)if(y[e]===this){y.splice(e,1);break}p===this&&(p=null),0===y.length&&(t.removeRoot(b),b=null)};var w=Object.create(null),O=["none","link","copy","copyLink","move","linkMove","copyMove","all"],k=t.addEvent;k("!PointerDown",4,n),k("!PointerMove",4,r),k("!PointerUp",4,i),k("!PointerCancel",4,l),k("dragstart",5,d),k("dragover",5,c),k("dragend",5,f),k("drag",5,u),k("drop",5,h),k("dragenter",5,g),k("dragleave",5,g),t.getDnds=function(){return y}}(b);