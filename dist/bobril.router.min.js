!function(n,e){function r(){return Z>=0&&clearTimeout(Z),Z=-1,n.invalidate(),!1}function t(n,r){var t=e.location;r?(j=n,t.hash=n.substring(1),O++):t.href=n}function a(n,r){var t=e.location;r?(j=n,t.replace(t.pathname+t.search+n)):t.replace(n)}function i(n){O-=n,Z=setTimeout(r,50),e.history.go(-n)}function u(n){return encodeURIComponent(n).replace(/%20/g,"+")}function o(n){return decodeURIComponent(n.replace(/\+/g," "))}function l(n){return(n+"").split("/").map(u).join("/")}function c(n){if(!(n in U)){var e=[],r=n.replace(I,function(n,r){return r?(e.push(r),"([^/?#]+)"):"*"===n?(e.push("splat"),"(.*?)"):"\\"+n});U[n]={matcher:RegExp("^"+r+"$","i"),paramNames:e}}return U[n]}function f(n,e){var r=c(n),t=o(e).match(r.matcher);if(!t)return null;for(var a={},i=r.paramNames,u=i.length,l=0;l<u;l++)a[i[l]]=t[l+1];return a}function s(n,e){e=e||{};var r=0;return n.replace(M,function(t,a){if(a=a||"splat","?"!==a.slice(-1)){if(null==e[a])throw Error('Missing "'+a+'" parameter for path "'+n+'"')}else if(a=a.slice(0,-1),null==e[a])return"";var i;if("splat"===a&&Array.isArray(e[a])){if(i=e[a][r++],null==i)throw Error("Missing splat # "+r+' for path "'+n+'"')}else i=e[a];return l(i)})}function p(n,e,r){for(var t,a,i,u=e.length,o=0;o<u;o++){var l=e[o];if(l.isNotFound)t=l;else if(l.isDefault)a=l;else{if(l.children){var c=p(n,l.children,r);if(c)return c.push(l),c}if(l.url&&(i=f(l.url,n)))return r.p=i,[l]}}return a&&(i=f(a.url,n))?(r.p=i,[a]):t&&(i=f(t.url,n))?(r.p=i,[t]):null}function d(n){return!K.test(n)}function h(n){return"/"===n[0]}function m(){return null}function v(n){for(;n>=J.length;)J.push(function(n,e){return function(r){r&&(n[e]=r)}}(G,n));return J[n]}function g(){if(!(Z>=0)){var r=e.location.hash,t=r.substr(1);h(t)||(t="/"+t);var a={p:{}},i=p(t,_,a)||[];if(L?(L=!1,Q={inApp:!0,type:2,name:null,params:null},V=-1,j=r):!Q&&i.length>0&&r!=j&&T($(i[0].name,a.p)),Q&&2===Q.type&&V<0){if(j=r,Q.inApp=!0,!(null==Q.name&&i.length>0))return;if(Q.name=i[0].name,Q.params=a.p,F(),null!=Q)return}if(null==Q){for(H=i;G.length>H.length;)G.pop();for(;G.length<H.length;)G.push(null);q=a.p}for(var u=m,o=0;o<H.length;o++)!function(e,r,t,a){u=function(i){var u=r.data||{};n.assign(u,i),u.activeRouteHandler=e,u.routeParams=t;var o,l=r.handler;return o="function"==typeof l?l(u):{key:void 0,ref:void 0,data:u,component:l},r.keyBuilder?o.key=r.keyBuilder(t):o.key=r.name,o.ref=v(a),o}}(u,H[o],q,o);return u()}}function y(n,e){return h(e)?e:"/"===n[n.length-1]?n+e:n+"/"+e}function A(n,e){for(var r=e.length,t=0;t<r;t++){var a=e[t],i=n,u=a.name;u||"/"!==n?u&&(x[u]=a,i=y(i,u)):(u="root",a.name=u,x[u]=a),a.isDefault?i=n:a.isNotFound?i=y(n,"*"):a.url&&(i=y(n,a.url)),a.url=i,a.children&&A(i,a.children)}}function k(e){n.isArray(e)||(e=[e]),A("/",e),_=e,n.init(g)}function N(n,e){return{name:n.name,url:n.url,data:n.data,handler:n.handler,keyBuilder:n.keyBuilder,children:e}}function R(n){return{name:n.name,data:n.data,handler:n.handler,keyBuilder:n.keyBuilder,isDefault:!0}}function P(n){return{name:n.name,data:n.data,handler:n.handler,keyBuilder:n.keyBuilder,isNotFound:!0}}function B(n,e){if(e)for(var r in e)if(e.hasOwnProperty(r)&&q[r]!==e[r])return!1;for(var t=0,a=H.length;t<a;t++)if(H[t].name===n)return!0;return!1}function b(n,e){if(d(n)){var r=x[n];return"#"+s(r.url,e)}return n}function w(e,r,t){return e.data=e.data||{},e.data.routeName=r,e.data.routeParams=t,n.postEnhance(e,{render:function(n,e){var r=n.data;e.attrs=e.attrs||{},"a"===e.tag&&(e.attrs.href=b(r.routeName,r.routeParams)),e.className=e.className||"",B(r.routeName,r.routeParams)&&(e.className+=" active")},onClick:function(n){var e=n.data;return T($(e.routeName,e.routeParams)),!0}}),e}function $(n,e){return{inApp:d(n),type:0,name:n,params:e||{}}}function D(n,e){return{inApp:d(n),type:1,name:n,params:e||{}}}function E(n){return n=n||1,{inApp:O>=n,type:2,name:null,params:{},distance:n}}function z(e){switch(e.type){case 0:t(b(e.name,e.params),e.inApp);break;case 1:a(b(e.name,e.params),e.inApp);break;case 2:i(e.distance)}n.invalidate()}function F(){for(;;){if(V>=0&&V<H.length){var e=G[V];if(V++,!e)continue;var r=e.component;if(!r)continue;var a=r.canDeactivate;if(!a)continue;var i=a.call(r,e.ctx,Q);return void Promise.resolve(i).then(function(n){if(n===!0);else{if(n===!1)return Q=null,void(S=null);S=n}F()})["catch"](function(n){"undefined"!=typeof console&&console.log&&console.log(n)})}if(V==H.length){if(S&&(Q&&0==Q.type&&t(b(Q.name,Q.params),Q.inApp),Q=S,S=null),V=-1,!Q.inApp||2===Q.type){var u=Q;return Q.inApp||(Q=null),void z(u)}}else{if(V!==-1){if(V===-2-C.length){if(S){V=H.length;continue}if(2!==Q.type){var u=Q;Q=null,z(u)}else n.invalidate();return void(Q=null)}if(S){V=H.length;continue}var o=C[C.length+1+V];V--;var l=o.handler,r=null;if("function"==typeof l){var e=l({});if(!e)continue;r=e.component}else r=l;if(!r)continue;var a=r.canActivate;if(!a)continue;var i=a.call(r,Q);if(i===!0)continue;return void Promise.resolve(i).then(function(n){if(n===!0);else{if(n===!1)return Q=null,void(S=null);S=n}F()})["catch"](function(n){"undefined"!=typeof console&&console.log&&console.log(n)})}var c={p:{}};C=Q.inApp?p(b(Q.name,Q.params).substring(1),_,c)||[]:[],V=-2}}}function T(n){return null!=Q?void(S=n):(L=!1,Q=n,V=0,void F())}var Z=-1;n.addEvent("hashchange",10,r);var _,C,O=0,j="",x={},I=/:([a-zA-Z_$][a-zA-Z0-9_$]*)|[*.()\[\]\\+|{}^$]/g,M=/:([a-zA-Z_$][a-zA-Z0-9_$?]*[?]?)|[*]/g,U={},H=[],q=Object.create(null),G=[],J=[],K=/\:|\//g,L=!0,Q=null,S=null,V=0;n.routes=k,n.route=N,n.routeDefault=R,n.routeNotFound=P,n.isRouteActive=B,n.urlOfRoute=b,n.createRedirectPush=$,n.createRedirectReplace=D,n.createBackTransition=E,n.runTransition=T,n.link=w,n.getRoutes=function(){return _},n.getActiveRoutes=function(){return H},n.getActiveParams=function(){return q}}(b,window);