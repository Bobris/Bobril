!function(t){function e(){if(null==O){var e=document.body.style;m=e.cursor,x=e[C],e[C]="none",O=t.addRoot(a)}}function r(){var t="no-drop";if(0!==Y.length){var e=Y[0];if(e.beforeDrag)return"";if(null!=e.cursor)return e.cursor;if(e.system)return"";switch(e.operation){case 3:t="move";break;case 1:t="alias";break;case 2:t="copy"}}return t}function a(){return{component:E}}function n(r,a,n){var l=P[r.id];if(l&&l.cancelDnd(),r.button<=1){l=new M(r.id),l.startX=r.x,l.startY=r.y,l.lastX=r.x,l.lastY=r.y,l.overNode=n,o(l,r);var s=t.bubble(n,"onDragStart",l);if(s){var d=t.getDomNode(s.me);if(null==d)return l.destroy(),!1;l.started=!0;var c=d.getBoundingClientRect;if(c){var u=c.call(d);l.deltaX=u.left-r.x,l.deltaY=u.top-r.y}l.distanceToStart<=0&&(l.beforeDrag=!1,i(n,l)),e()}else l.destroy()}return!1}function i(e,r){r.overNode=e,r.targetCtx=t.bubble(e,"onDragOver",r),null==r.targetCtx&&(r.operation=0),t.broadcast("onDrag",r)}function o(t,e){t.shift=e.shift,t.ctrl=e.ctrl,t.alt=e.alt,t.meta=e.meta,t.x=e.x,t.y=e.y}function l(t,e,r){var a=P[t.id];if(!a)return!1;if(a.totalX+=Math.abs(t.x-a.lastX),a.totalY+=Math.abs(t.y-a.lastY),a.beforeDrag){if(a.totalX+a.totalY<=a.distanceToStart)return a.lastX=t.x,a.lastY=t.y,!1;a.beforeDrag=!1}return o(a,t),i(r,a),a.lastX=t.x,a.lastY=t.y,!0}function s(e,r,a){var n=P[e.id];if(!n)return!1;if(!n.beforeDrag){o(n,e),i(a,n);var l=n.targetCtx;return l&&t.bubble(l.me,"onDrop",n)?n.destroy():n.cancelDnd(),!0}return n.destroy(),!1}function d(t){var e=P[t.id];return e?(e.beforeDrag?e.destroy():e.cancelDnd(),!1):!1}function c(e,r){e.shift=r.shiftKey,e.ctrl=r.ctrlKey,e.alt=r.altKey,e.meta=r.metaKey,e.x=r.clientX,e.y=r.clientY,e.totalX+=Math.abs(e.x-e.lastX),e.totalY+=Math.abs(e.y-e.lastY);var a=t.nodeOnPoint(e.x,e.y);i(a,e),e.lastX=e.x,e.lastY=e.y}function u(r,a,n){var i=w;null!=i&&i.destroy();var o=Object.keys(P);if(o.length>0)i=P[o[0]],i.system=!0,w=i;else{var l=r.clientX,s=r.clientY;i=new M(-1),i.system=!0,w=i,i.x=l,i.y=s,i.lastX=l,i.lastY=s,i.startX=l,i.startY=s;var d=t.bubble(n,"onDragStart",i);if(!d)return i.destroy(),!1;var u=t.getDomNode(d.me);if(null==u)return i.destroy(),!1;i.started=!0;var f=u.getBoundingClientRect;if(f){var h=f.call(u);i.deltaX=h.left-l,i.deltaY=h.top-s}e()}i.beforeDrag=!1;var y=V[i.enabledOperations],g=r.dataTransfer;if(g.effectAllowed=y,g.setDragImage){var v=document.createElement("div");v.style.pointerEvents="none",g.setDragImage(v,0,0)}else{var b=r.target.style,p=b.opacity,D=b.width,m=b.height,x=b.padding;b.opacity="0",b.width="0",b.height="0",b.padding="0",window.setTimeout(function(){b.opacity=p,b.width=D,b.height=m,b.padding=x},0)}for(var X=i.data,Y=Object.keys(X),O=0;O<Y.length;O++)try{var k=Y[O],T=X[k];"string"!=typeof T&&(T=JSON.stringify(T)),r.dataTransfer.setData(k,T)}catch(S){}return c(i,r),!1}function f(t,e){t.dataTransfer.dropEffect=["none","link","copy","move"][e]}function h(t){var e=w;if(null==e){e=new M(-1),e.system=!0,w=e,e.x=t.clientX,e.y=t.clientY,e.startX=e.x,e.startY=e.y,e.local=!1;var r=t.dataTransfer,a=0;try{var n=r.effectAllowed}catch(i){}for(;7>a&&V[a]!==n;a++);e.enabledOperations=a;var o=r.types;if(o)for(var l=0;l<o.length;l++){var s=o[l];"text/plain"===s?s="Text":"text/uri-list"===s&&(s="Url"),e.data[s]=null}else void 0!==r.getData("Text")&&(e.data.Text=null)}return c(e,t),f(t,e.operation),0!=e.operation?(k(t),!0):!1}function y(e){var r=e.clientX,a=e.clientY,n=t.getMedia();return null!=w&&(0===r&&0===a||0>r||0>a||r>=n.width||a>=n.height)&&(w.x=0,w.y=0,w.operation=0,t.broadcast("onDrag",w)),!1}function g(){return null!=w&&w.destroy(),!1}function v(e){var r=w;if(null==r)return!1;if(r.x=e.clientX,r.y=e.clientY,!r.local)for(var a=Object.keys(r.data),n=e.dataTransfer,i=0;i<a.length;i++){var o,l=a[i];o="Files"===l?[].slice.call(n.files,0):n.getData(l),r.data[l]=o}c(r,e);var s=r.targetCtx;return s&&t.bubble(s.me,"onDrop",r)?(f(e,r.operation),r.destroy(),k(e)):r.cancelDnd(),!0}function b(t){return k(t),!0}function p(t){return 0===Y.length?!1:(k(t),!0)}function D(){for(var t=0;t<Y.length;t++){var e=Y[t];if(!e.beforeDrag)return e}return null}var m,x,X=0,Y=[],w=null,O=null,k=t.preventDefault,T={userSelect:""};t.shimStyle(T);var S=Object.keys(T),C=S[S.length-1],M=function(t){this.id=++X,this.pointerid=t,this.enabledOperations=7,this.operation=0,this.started=!1,this.beforeDrag=!0,this.local=!0,this.system=!1,this.ended=!1,this.cursor=null,this.overNode=null,this.targetCtx=null,this.dragView=null,this.startX=0,this.startY=0,this.distanceToStart=10,this.x=0,this.y=0,this.deltaX=0,this.deltaY=0,this.totalX=0,this.totalY=0,this.lastX=0,this.lastY=0,this.shift=!1,this.ctrl=!1,this.alt=!1,this.meta=!1,this.data=Object.create(null),t>=0&&(P[t]=this),Y.push(this)},j={render:function(t,e){var r=t.data;e.tag="div",e.style={position:"absolute",left:r.x,top:r.y},e.children=r.dragView(r)}},E={render:function(t,e){for(var a=[],n=0;n<Y.length;n++){var i=Y[n];i.beforeDrag||null==i.dragView||0==i.x&&0==i.y||a.push({key:""+i.id,data:i,component:j})}e.tag="div",e.style={position:"fixed",pointerEvents:"none",userSelect:"none",left:0,top:0,right:0,bottom:0};var o=document.body.style,l=r();l&&o.cursor!==l&&(o.cursor=l),e.children=a},onDrag:function(e){return t.invalidate(e),!1}},N=M.prototype;N.setOperation=function(t){this.operation=t},N.setDragNodeView=function(t){this.dragView=t},N.addData=function(t,e){return this.data[t]=e,!0},N.listData=function(){return Object.keys(this.data)},N.hasData=function(t){return void 0!==this.data[t]},N.getData=function(t){return this.data[t]},N.setEnabledOps=function(t){this.enabledOperations=t},N.cancelDnd=function(){i(null,this),this.destroy()},N.destroy=function(){this.ended=!0,this.started&&t.broadcast("onDragEnd",this),delete P[this.pointerid];for(var e=0;e<Y.length;e++)if(Y[e]===this){Y.splice(e,1);break}if(w===this&&(w=null),0===Y.length&&null!=O){t.removeRoot(O),O=null;var r=document.body.style;r.cursor=m,r[C]=x}};var P=Object.create(null),V=["none","link","copy","copyLink","move","linkMove","copyMove","all"],K=t.addEvent;K("!PointerDown",4,n),K("!PointerMove",4,l),K("!PointerUp",4,s),K("!PointerCancel",4,d),K("selectstart",4,p),K("dragstart",5,u),K("dragover",5,h),K("dragend",5,g),K("drag",5,y),K("drop",5,v),K("dragenter",5,b),K("dragleave",5,b),t.getDnds=function(){return Y},t.anyActiveDnd=D}(b);