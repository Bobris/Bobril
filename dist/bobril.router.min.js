!function(n,r){function t(){return n.invalidate(),!1}function a(n){w=R,r.location.hash=n}function e(n){return encodeURIComponent(n).replace(/%20/g,"+")}function u(n){return decodeURIComponent(n.replace(/\+/g," "))}function i(n){return(n+"").split("/").map(e).join("/")}function o(n){if(!(n in C)){var r=[],t=n.replace(_,function(n,t){return t?(r.push(t),"([^/?#]+)"):"*"===n?(r.push("splat"),"(.*?)"):"\\"+n});C[n]={matcher:RegExp("^"+t+"$","i"),paramNames:r}}return C[n]}function l(n,r){var t=o(n),a=u(r).match(t.matcher);if(!a)return null;for(var e={},i=t.paramNames,l=i.length,f=0;l>f;f++)e[i[f]]=a[f+1];return e}function f(n,r){r=r||{};var t=0;return n.replace(y,function(a,e){if(e=e||"splat","?"!==e.slice(-1)){if(null==r[e])throw Error('Missing "'+e+'" parameter for path "'+n+'"')}else if(e=e.slice(0,-1),null==r[e])return"";var u;if("splat"===e&&Array.isArray(r[e])){if(u=r[e][t++],null==u)throw Error("Missing splat # "+t+' for path "'+n+'"')}else u=r[e];return i(u)})}function c(n,r,t){for(var a,e,u,i=r.length,o=0;i>o;o++){var f=r[o];if(f.isNotFound)a=f;else if(f.isDefault)e=f;else{if(f.children){var s=c(n,f.children,t);if(s)return s.push(f),s}if(f.url&&(u=l(f.url,n)))return t.p=u,[f]}}return e&&(u=l(e.url,n))?(t.p=u,[e]):a&&(u=l(a.url,n))?(t.p=u,[a]):null}function s(){var t=r.location.hash.substr(1);h(t)||(t="/"+t);var a={p:{}},e=c(t,z,a)||[];D=e,F=a.p;for(var u=d,i=0;i<e.length;i++)!function(r,t,a){u=function(e){var u=t.data||{};return n.assign(u,e),u.activeRouteHandler=r,u.routeParams=a,{data:u,component:t.handler}}}(u,e[i],F);return u()}function d(){return null}function h(n){return"/"==n[0]}function p(n,r){return h(r)?r:"/"==n[n.length-1]?n+r:n+"/"+r}function v(n,r){for(var t=r.length,a=0;t>a;a++){var e=r[a],u=n,i=e.name;i&&(Z[i]=e,u=p(u,i)),e.isDefault?u=n:e.isNotFound?u=p(n,"*"):e.url&&(u=p(n,e.url)),e.url=u,e.children&&v(u,e.children)}}function m(r){n.isArray(r)||(r=[r]),v("/",r),z=r,n.init(s)}function g(n,r){return{name:n.name,url:n.url,data:n.data,handler:n.handler,children:r}}function A(n){return{name:n.name,data:n.data,handler:n.handler,isDefault:!0}}function N(n){return{name:n.name,data:n.data,handler:n.handler,isNotFound:!0}}function $(n,r){if(r)for(var t in r)if(F[t]!==r[t])return!1;for(var a=0,e=D.length;e>a;a++)if(D[a].name==n)return!0;return!1}function E(r,t,e){var u=Z[t],i=f(u.url,e);return r.data=r.data||{},r.data.active=$(t,e),r.data.url=i,n.postEnhance(r,{init:function(n,r){r.attrs=r.attrs||{},"a"==r.tag&&(r.attrs.href="#"+i),n.data.active&&(r.attrs.className+=" active")},onClick:function(n){return a(n.data.url),!0}}),r}n.addEvent("hashchange",100,t);var w,z,D,F,R=0,Z={},_=/:([a-zA-Z_$][a-zA-Z0-9_$]*)|[*.()\[\]\\+|{}^$]/g,y=/:([a-zA-Z_$][a-zA-Z0-9_$?]*[?]?)|[*]/g,C={};n.routes=m,n.route=g,n.routeDefault=A,n.routeNotFound=N,n.link=E}(b,window);