!function(r,n){function t(){return r.invalidate(),!1}function a(r){E=F,n.location.hash=r}function e(r){return encodeURIComponent(r).replace(/%20/g,"+")}function u(r){return decodeURIComponent(r.replace(/\+/g," "))}function i(r){return(r+"").split("/").map(e).join("/")}function l(r){if(!(r in C)){var n=[],t=r.replace(Z,function(r,t){return t?(n.push(t),"([^/?#]+)"):"*"===r?(n.push("splat"),"(.*?)"):"\\"+r});C[r]={matcher:RegExp("^"+t+"$","i"),paramNames:n}}return C[r]}function o(r,n){var t=l(r),a=u(n).match(t.matcher);if(!a)return null;for(var e={},i=t.paramNames,o=i.length,c=0;o>c;c++)e[i[c]]=a[c+1];return e}function c(r,n){n=n||{};var t=0;return r.replace(_,function(a,e){if(e=e||"splat","?"!==e.slice(-1)){if(null==n[e])throw Error('Missing "'+e+'" parameter for path "'+r+'"')}else if(e=e.slice(0,-1),null==n[e])return"";var u;if("splat"===e&&Array.isArray(n[e])){if(u=n[e][t++],null==u)throw Error("Missing splat # "+t+' for path "'+r+'"')}else u=n[e];return i(u)})}function f(r,n,t){for(var a,e,u,i=n.length,l=0;i>l;l++){var c=n[l];if(c.isNotFound)a=c;else if(c.isDefault)e=c;else{if(c.children){var s=f(r,c.children,t);if(s)return s.push(c),s}if(c.url&&(u=o(c.url,r)))return t.p=u,[c]}}return e&&(u=o(e.url,r))?(t.p=u,[e]):a&&(u=o(a.url,r))?(t.p=u,[a]):null}function s(r){return"/"===r[0]}function d(){return null}function h(){var t=n.location.hash.substr(1);s(t)||(t="/"+t);var a={p:{}},e=f(t,y,a)||[];z=e,D=a.p;for(var u=d,i=0;i<e.length;i++)!function(n,t,a){u=function(e){var u=t.data||{};return r.assign(u,e),u.activeRouteHandler=n,u.routeParams=a,{data:u,component:t.handler}}}(u,e[i],D);return u()}function p(r,n){return s(n)?n:"/"===r[r.length-1]?r+n:r+"/"+n}function m(r,n){for(var t=n.length,a=0;t>a;a++){var e=n[a],u=r,i=e.name;i&&(R[i]=e,u=p(u,i)),e.isDefault?u=r:e.isNotFound?u=p(r,"*"):e.url&&(u=p(r,e.url)),e.url=u,e.children&&m(u,e.children)}}function v(n){r.isArray(n)||(n=[n]),m("/",n),y=n,r.init(h)}function g(r,n){return{name:r.name,url:r.url,data:r.data,handler:r.handler,children:n}}function N(r){return{name:r.name,data:r.data,handler:r.handler,isDefault:!0}}function A(r){return{name:r.name,data:r.data,handler:r.handler,isNotFound:!0}}function $(r,n){if(n)for(var t in n)if(n.hasOwnProperty(t)&&D[t]!==n[t])return!1;for(var a=0,e=z.length;e>a;a++)if(z[a].name===r)return!0;return!1}function w(n,t,e){var u=R[t],i=c(u.url,e);return n.data=n.data||{},n.data.active=$(t,e),n.data.url=i,r.postEnhance(n,{render:function(r,n){n.attrs=n.attrs||{},"a"===n.tag&&(n.attrs.href="#"+i),n.attrs.className=n.attrs.className||"",r.data.active&&(n.attrs.className+=" active")},onClick:function(r){return a(r.data.url),!0}}),n}r.addEvent("hashchange",100,t);var E,y,z,D,F=0,R={},Z=/:([a-zA-Z_$][a-zA-Z0-9_$]*)|[*.()\[\]\\+|{}^$]/g,_=/:([a-zA-Z_$][a-zA-Z0-9_$?]*[?]?)|[*]/g,C={};r.routes=v,r.route=g,r.routeDefault=N,r.routeNotFound=A,r.link=w}(b,window);