!function(r,n){function e(){return r.invalidate(),!1}function a(r){A=z,n.location.hash=r}function t(r){return encodeURIComponent(r).replace(/%20/g,"+")}function u(r){return decodeURIComponent(r.replace(/\+/g," "))}function i(r){return(r+"").split("/").map(t).join("/")}function l(r){if(!(r in Z)){var n=[],e=r.replace(F,function(r,e){return e?(n.push(e),"([^/?#]+)"):"*"===r?(n.push("splat"),"(.*?)"):"\\"+r});Z[r]={matcher:RegExp("^"+e+"$","i"),paramNames:n}}return Z[r]}function o(r,n){var e=l(r),a=u(n).match(e.matcher);if(!a)return null;for(var t={},i=e.paramNames,o=i.length,c=0;o>c;c++)t[i[c]]=a[c+1];return t}function c(r,n){n=n||{};var e=0;return r.replace(R,function(a,t){if(t=t||"splat","?"!==t.slice(-1)){if(null==n[t])throw Error('Missing "'+t+'" parameter for path "'+r+'"')}else if(t=t.slice(0,-1),null==n[t])return"";var u;if("splat"===t&&Array.isArray(n[t])){if(u=n[t][e++],null==u)throw Error("Missing splat # "+e+' for path "'+r+'"')}else u=n[t];return i(u)})}function f(r,n,e){for(var a,t,u,i=n.length,l=0;i>l;l++){var c=n[l];if(c.isNotFound)a=c;else if(c.isDefault)t=c;else{if(c.children){var d=f(r,c.children,e);if(d)return d.push(c),d}if(c.url&&(u=o(c.url,r)))return e.p=u,[c]}}return t&&(u=o(t.url,r))?(e.p=u,[t]):a&&(u=o(a.url,r))?(e.p=u,[a]):null}function d(r){return"/"===r[0]}function s(){return null}function h(){var e=n.location.hash.substr(1);d(e)||(e="/"+e);var a={p:{}},t=f(e,$,a)||[];w=t,E=a.p;for(var u=s,i=0;i<t.length;i++)!function(n,e,a){u=function(t){var u=e.data||{};return r.assign(u,t),u.activeRouteHandler=n,u.routeParams=a,{key:e.keyBuilder?e.keyBuilder(a):void 0,data:u,component:e.handler}}}(u,t[i],E);return u()}function p(r,n){return d(n)?n:"/"===r[r.length-1]?r+n:r+"/"+n}function v(r,n){for(var e=n.length,a=0;e>a;a++){var t=n[a],u=r,i=t.name;i&&(D[i]=t,u=p(u,i)),t.isDefault?u=r:t.isNotFound?u=p(r,"*"):t.url&&(u=p(r,t.url)),t.url=u,t.children&&v(u,t.children)}}function m(n){r.isArray(n)||(n=[n]),v("/",n),$=n,r.init(h)}function g(r,n){return{name:r.name,url:r.url,data:r.data,handler:r.handler,keyBuilder:r.keyBuilder,children:n}}function y(r){return{name:r.name,data:r.data,handler:r.handler,keyBuilder:r.keyBuilder,isDefault:!0}}function k(r){return{name:r.name,data:r.data,handler:r.handler,keyBuilder:r.keyBuilder,isNotFound:!0}}function N(r,n){if(n)for(var e in n)if(n.hasOwnProperty(e)&&E[e]!==n[e])return!1;for(var a=0,t=w.length;t>a;a++)if(w[a].name===r)return!0;return!1}function B(n,e,t){var u=D[e],i=c(u.url,t);return n.data=n.data||{},n.data.active=N(e,t),n.data.url=i,r.postEnhance(n,{render:function(r,n){n.attrs=n.attrs||{},"a"===n.tag&&(n.attrs.href="#"+i),n.className=n.className||"",r.data.active&&(n.className+=" active")},onClick:function(r){return a(r.data.url),!0}}),n}r.addEvent("hashchange",100,e);var A,$,w,E,z=0,D={},F=/:([a-zA-Z_$][a-zA-Z0-9_$]*)|[*.()\[\]\\+|{}^$]/g,R=/:([a-zA-Z_$][a-zA-Z0-9_$?]*[?]?)|[*]/g,Z={};r.routes=m,r.route=g,r.routeDefault=y,r.routeNotFound=k,r.link=B}(b,window);