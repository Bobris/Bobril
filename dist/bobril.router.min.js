!function(r,n){function t(){return r.invalidate(),!1}function a(r){E=Z,n.location.hash=r}function e(r){return encodeURIComponent(r).replace(/%20/g,"+")}function u(r){return decodeURIComponent(r.replace(/\+/g," "))}function i(r){return(r+"").split("/").map(e).join("/")}function o(r){if(!(r in N)){var n=[],t=r.replace(y,function(r,t){return t?(n.push(t),"([^/?#]+)"):"*"===r?(n.push("splat"),"(.*?)"):"\\"+r});N[r]={matcher:RegExp("^"+t+"$","i"),paramNames:n}}return N[r]}function l(r,n){var t=o(r),a=u(n).match(t.matcher);if(!a)return null;for(var e={},i=t.paramNames,l=i.length,c=0;l>c;c++)e[i[c]]=a[c+1];return e}function c(r,n){n=n||{};var t=0;return r.replace(C,function(a,e){if(e=e||"splat","?"!==e.slice(-1)){if(null==n[e])throw Error('Missing "'+e+'" parameter for path "'+r+'"')}else if(e=e.slice(0,-1),null==n[e])return"";var u;if("splat"===e&&Array.isArray(n[e])){if(u=n[e][t++],null==u)throw Error("Missing splat # "+t+' for path "'+r+'"')}else u=n[e];return i(u)})}function f(r,n,t){for(var a=n.length,e=0;a>e;e++){var u=n[e];if(u.children){var i=f(r,u.children,t);if(i)return i.push(u),i}if(u.url){var o=l(u.url,r);if(o)return t.p=o,[u]}}return null}function s(){var r=n.location.hash.substr(1);p(r)||(r="/"+r);var t={p:{}},a=f(r,w,t)||[];z=a,R=t.p;for(var e=h,u=0;u<a.length;u++)!function(r,n,t){e=function(a){return a=a||{},a.activeRouteHandler=r,a.routeParams=t,{data:a,component:n.handler}}}(e,a[u],R);return e()}function h(){return null}function p(r){return"/"==r[0]}function v(r,n){return p(n)?n:"/"==r[r.length-1]?r+n:r+"/"+n}function d(r,n){for(var t=n.length,a=0;t>a;a++){var e=n[a],u=r,i=e.name;i&&(_[i]=e,u=v(u,i)),e.url&&(u=v(r,e.url)),e.url=u,e.children&&d(u,e.children)}}function m(n){r.isArray(n)||(n=[n]),d("/",n),w=n,r.init(s)}function g(r,n){return{name:r.name,url:r.url,handler:r.handler,children:n}}function A(r,n){if(n)for(var t in n)if(R[t]!==n[t])return!1;for(var a=0,e=z.length;e>a;a++)if(z[a].name==r)return!0;return!1}function $(n,t,e){var u=_[t],i=c(u.url,e);return n.data=n.data||{},n.data.active=A(t,e),n.data.url=i,r.postEnhance(n,{init:function(r,n){n.attrs=n.attrs||{},"a"==n.tag&&(n.attrs.href="#"+i),r.data.active&&(n.attrs.className+=" active")},onClick:function(r){return a(r.data.url),!0}}),n}r.addEvent("hashchange",100,t);var E,w,z,R,Z=0,_={},y=/:([a-zA-Z_$][a-zA-Z0-9_$]*)|[*.()\[\]\\+|{}^$]/g,C=/:([a-zA-Z_$][a-zA-Z0-9_$?]*[?]?)|[*]/g,N={};r.routes=m,r.route=g,r.link=$}(b,window);