!function(n){function t(){var t=document.hasFocus()?document.activeElement:null;if(t!==u){u=t;for(var e=n.vdomPath(u),o=0;o<l.length&&o<e.length&&l[o]===e[o];)o++;var r,c,s=l.length-1;for(s>=o&&(r=l[s],r&&(c=r.component,c&&c.onBlur&&c.onBlur(r.ctx)),s--);s>=o;)r=l[s],r&&(c=r.component,c&&c.onFocusOut&&c.onFocusOut(r.ctx)),s--;for(s=o;s+1<e.length;)r=e[s],r&&(c=r.component,c&&c.onFocusIn&&c.onFocusIn(r.ctx)),s++;s<e.length&&(r=e[s],r&&(c=r.component,c&&c.onFocus&&c.onFocus(r.ctx)),s++),l=e,i=0==l.length?null:l[l.length-1]}}function e(){setTimeout(t,10),t()}function o(){return i}function r(e){if(null==e)return!1;if("string"==typeof e)return!1;var o=e.style;if(null!=o){if("hidden"===o.visibility)return!1;if("none"===o.display)return!1}var u=e.attrs;if(null!=u){var i=u.tabindex||u.tabIndex;if(void 0!==i||f.test(e.tag)){if(-1===+i)return!1;var l=e.element;return l.focus(),t(),!0}}var c=e.children;if(n.isArray(c)){for(var s=0;s<c.length;s++)if(r(c[s]))return!0;return!1}return r(c)}for(var u=null,i=null,l=[],c=["focus","blur","keydown","keyup","keypress","mousedown","mouseup","mousemove","touchstart","touchend"],s=0;s<c.length;s++)n.addEvent(c[s],50,n.ieVersion()?e:t);8===n.ieVersion()&&setInterval(t,100);var f=/^input$|^select$|^textarea$|^button$/;n.focused=o,n.focus=r}(b);